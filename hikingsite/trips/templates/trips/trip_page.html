{% extends "layout.html" %}
{% load static %}

{% block title %}
    {{ trip.title }} - {{ trip.location }}
{% endblock %}

{% block content %}
    <section>
        <!-- Trip Banner -->
        <img 
            class="banner"
            src="{{ trip.image.url }}"
            alt="{{ trip.title }} banner"
        />

        <!-- Title and Location -->
        <h1>{{ trip.title }} - {{ trip.location }}</h1>

        <!-- Dates and Duration -->
        <p><strong>Dates:</strong> {{ trip.start_date }} to {{ trip.end_date }}</p>
        <p><strong>Total Duration:</strong> {{ trip.duration }} days</p>
        <p><strong>Hiking Time:</strong> {{ trip.hiking_duration }} hours</p>

        <!-- Difficulty & Terrain -->
        <p><strong>Difficulty:</strong> {{ trip.difficulty }}</p>
        <p><strong>Terrain:</strong> {{ trip.terrain }}</p>

        <!-- Distance & Altitude -->
        <p><strong>Distance:</strong> {{ trip.distance }} km</p>
        <p><strong>Altitude Change:</strong> {{ trip.altitude_difference }} m</p>

        <!-- Max Participants & Price -->
        <p><strong>Max Participants:</strong> {{ trip.max_participants }}</p>
        <p><strong>Price:</strong> ${{ trip.price }}</p>

        <!-- Guide -->
        <p><strong>Guide:</strong> {{ trip.guide }}</p>

        <!-- Description -->
        <p><strong>Description:</strong> {{ trip.description }}</p>

        <!-- Navigation -->
        <p>
            <a href="{% url 'trips:list' %}">‚Üê Go back to all trips</a>
        </p>

        {% if user.is_authenticated and not user_has_reviewed %}
            <a href="{% url 'trips:add-review' slug=trip.slug %}" class="btn btn-outline-primary">Leave a Review</a>
        {% endif %}


        <h3 class="mt-4">Reviews</h3>
        {% if trip.trip_reviews.all %}
            {% for review in trip.trip_reviews.all %}
                <div class="review">
                    <strong>{{ review.user.username }}</strong>
                    <span>Rated: {{ review.rating }}/5</span>
                    <p>{{ review.comment }}</p>
                    <small>{{ review.created_at|date:"Y-m-d H:i" }}</small>
                    <hr>
                </div>
            {% endfor %}
        {% else %}
            <p>No reviews yet for this trip.</p>
        {% endif %}


        {% if user.is_authenticated %}
            {% if already_booked %}
                <p class="text-danger">You have already booked this trip.</p>
            {% elif in_cart %}
                <p class="text-info">Already in cart</p>
            {% else %}
                <form action="{% url 'trips:add-to-cart' slug=trip.slug %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success">Add to Cart</button>
                </form>
            {% endif %}
        {% endif %}
        {% if user.is_authenticated and trip.guide == user.guide_profile %}
            <a href="{% url 'trips:edit-trip' slug=trip.slug %}" class="btn btn-outline-primary">Edit Trip</a>
        {% endif %}


    </section>
{% endblock %}
